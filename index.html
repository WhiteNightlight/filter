<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1.0"/>
  <title>دریافت سریع V2Ray</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      min-height: 100vh;
      display: flex;
      justify-content: center;
      align-items: center;
      padding: 20px;
    }

    .box {
      background: rgba(255, 255, 255, 0.95);
      border-radius: 20px;
      padding: 40px;
      max-width: 500px;
      width: 100%;
      box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
      text-align: center;
      backdrop-filter: blur(10px);
    }

    h2 {
      color: #333;
      margin-bottom: 10px;
      font-size: 24px;
    }

    p {
      color: #666;
      margin-bottom: 30px;
      line-height: 1.6;
    }

    input {
      width: 100%;
      padding: 15px;
      border: 2px solid #ddd;
      border-radius: 10px;
      font-size: 16px;
      margin-bottom: 20px;
      transition: all 0.3s ease;
    }

    input:focus {
      outline: none;
      border-color: #667eea;
      box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
    }

    .btn {
      width: 100%;
      padding: 15px;
      background: linear-gradient(45deg, #667eea, #764ba2);
      color: white;
      border: none;
      border-radius: 10px;
      font-size: 18px;
      font-weight: bold;
      cursor: pointer;
      transition: all 0.3s ease;
      margin-bottom: 20px;
    }

    .btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 10px 20px rgba(102, 126, 234, 0.3);
    }

    .btn:disabled {
      opacity: 0.6;
      cursor: not-allowed;
      transform: none;
    }

    .status {
      padding: 15px;
      border-radius: 10px;
      margin-bottom: 20px;
      font-weight: bold;
      display: none;
    }

    .status.success {
      background: #d4edda;
      color: #155724;
      border: 1px solid #c3e6cb;
      display: block;
    }

    .status.error {
      background: #f8d7da;
      color: #721c24;
      border: 1px solid #f5c6cb;
      display: block;
    }

    .status.info {
      background: #d1ecf1;
      color: #0c5460;
      border: 1px solid #bee5eb;
      display: block;
    }

    .config-display {
      background: #f8f9fa;
      border: 2px solid #dee2e6;
      border-radius: 10px;
      padding: 15px;
      margin-bottom: 20px;
      font-family: 'Courier New', monospace;
      font-size: 12px;
      word-break: break-all;
      max-height: 200px;
      overflow-y: auto;
      display: none;
      text-align: left;
    }

    .config-display.select-text {
      user-select: all;
      -webkit-user-select: all;
      -moz-user-select: all;
      -ms-user-select: all;
    }

    .step-instructions {
      background: #fff3cd;
      border: 1px solid #ffeaa7;
      border-radius: 10px;
      padding: 20px;
      margin-top: 20px;
      display: none;
      text-align: right;
    }

    .step-instructions strong {
      color: #856404;
      display: block;
      margin-bottom: 10px;
    }

    .step-instructions ol {
      text-align: right;
      color: #856404;
      line-height: 1.6;
    }

    .copy-btn {
      width: 100%;
      padding: 10px;
      background: #17a2b8;
      color: white;
      border: none;
      border-radius: 5px;
      cursor: pointer;
      margin-top: 15px;
      transition: all 0.3s ease;
    }

    .copy-btn:hover {
      background: #138496;
    }

    .import-buttons {
      display: flex;
      gap: 10px;
      margin-top: 15px;
      flex-wrap: wrap;
    }

    .import-btn {
      flex: 1;
      padding: 10px;
      background: #28a745;
      color: white;
      border: none;
      border-radius: 5px;
      cursor: pointer;
      font-size: 14px;
      transition: all 0.3s ease;
      min-width: 120px;
    }

    .import-btn:hover {
      background: #218838;
    }

    .import-btn:disabled {
      opacity: 0.6;
      cursor: not-allowed;
    }

    .loader {
      border: 4px solid #f3f3f3;
      border-top: 4px solid #3498db;
      border-radius: 50%;
      width: 20px;
      height: 20px;
      animation: spin 1s linear infinite;
      display: inline-block;
      margin-left: 10px;
    }

    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }
  </style>
</head>
<body>
  <div class="box">
    <h2>🚀 انتقال خودکار کانفیگ</h2>
    <p>با یک کلیک، کانفیگ را دریافت و وارد Hiddify کنید</p>
    <input type="password" id="passwordInput" placeholder="رمز عبور را وارد کنید"/>
    <button class="btn" id="fetchBtn">📡 دریافت و نصب</button>
    <div class="status" id="status"></div>
    <div class="config-display" id="configDisplay"></div>
    
    <div class="import-buttons" id="importButtons" style="display: none;">
      <button class="import-btn" id="directImportBtn">📥 وارد کردن مستقیم</button>
      <button class="import-btn" id="manualImportBtn">📋 کپی لینک</button>
    </div>

    <div class="step-instructions" id="instructions">
      <strong>مراحل نصب دستی:</strong>
      <ol>
        <li>لینک کانفیگ را کپی کنید</li>
        <li>اپلیکیشن Hiddify را باز کنید</li>
        <li>روی "+" کلیک کنید</li>
        <li>گزینه "Add Profile" را انتخاب کنید</li>
        <li>لینک کپی شده را وارد کنید</li>
        <li>روی "Add" کلیک کنید</li>
      </ol>
      <button class="copy-btn" id="manualCopyBtn">🔄 تلاش مجدد کپی</button>
    </div>
  </div>

  <script>
    // Security: Obfuscated and encrypted configuration
    const _0x1a2b = ['aHR0cHM6Ly9yYXcuZ2l0aHVidXNlcmNvbnRlbnQuY29tL0Vwb2Rvbmlvcy92MnJheS1jb25maWdzL3JlZnMvaGVhZHMvbWFpbi9TdWIxLnR4dA==', 'aHR0cHM6Ly9naXN0LmdpdGh1YnVzZXJjb250ZW50LmNvbS9XaGl0ZU5pZ2h0bGlnaHQvOGQ0ZDViNmQ2OTZkOWU3YzBkYjAyMWY3MDM2NGQ0NjkvcmF3L3Zhcw=='];
    const _0x3c4d = atob(_0x1a2b[0]);
    const _0x5e6f = atob(_0x1a2b[1]);
    
    // Anti-debugging measures
    const _0x7a8b = {
      _0x9c0d: function() {
        setInterval(() => {
          const _0x1e2f = new Date();
          debugger;
          if (new Date() - _0x1e2f > 100) {
            document.body.innerHTML = '<h1>⚠️ دسترسی غیرمجاز تشخیص داده شد</h1>';
          }
        }, 1000);
      },
      _0x3f4g: function() {
        document.addEventListener('keydown', function(e) {
          if (e.key === 'F12' || (e.ctrlKey && e.shiftKey && e.key === 'I') || (e.ctrlKey && e.shiftKey && e.key === 'J') || (e.ctrlKey && e.key === 'U')) {
            e.preventDefault();
            e.stopPropagation();
            document.body.innerHTML = '<h1>⚠️ دسترسی غیرمجاز تشخیص داده شد</h1>';
            return false;
          }
        });
      },
      _0x5h6i: function() {
        document.addEventListener('contextmenu', function(e) {
          e.preventDefault();
        });
      }
    };

    // Initialize security measures
    _0x7a8b._0x9c0d();
    _0x7a8b._0x3f4g();
    _0x7a8b._0x5h6i();

    // Element references
    const status = document.getElementById('status');
    const fetchBtn = document.getElementById('fetchBtn');
    const configDisplay = document.getElementById('configDisplay');
    const instructions = document.getElementById('instructions');
    const passwordInput = document.getElementById('passwordInput');
    const importButtons = document.getElementById('importButtons');
    const directImportBtn = document.getElementById('directImportBtn');
    const manualImportBtn = document.getElementById('manualImportBtn');

    let _0x9j0k = '';
    let _0x1l2m = '';

    // Encrypted utility functions
    async function _0x3n4o(text) {
      const _0x5p6q = await crypto.subtle.digest('SHA-256', new TextEncoder().encode(text + 'v2ray_salt_' + Date.now().toString().slice(0, 8)));
      return Array.from(new Uint8Array(_0x5p6q)).map(b => b.toString(16).padStart(2,'0')).join('');
    }

    async function _0x7r8s() {
      try {
        const _0x9t0u = await fetch(_0x5e6f, {
          method: 'GET',
          headers: {
            'Cache-Control': 'no-cache',
            'X-Requested-With': 'XMLHttpRequest',
            'User-Agent': navigator.userAgent + '_v2ray_client'
          }
        });
        if (!_0x9t0u.ok) throw new Error('Auth failed');
        return (await _0x9t0u.text()).trim();
      } catch (error) {
        console.error('Auth error:', error);
        return 'demo_hash_' + btoa(Date.now().toString());
      }
    }

    async function _0x1v2w() {
      const _0x3x4y = sessionStorage.getItem('_cfg_auth');
      if (!_0x3x4y) return false;
      try {
        const _0x5z6a = await _0x7r8s();
        const _0x7b8c = await _0x3n4o(_0x3x4y);
        if (_0x7b8c === _0x5z6a) {
          passwordInput.style.display = 'none';
          return true;
        }
      } catch (error) {
        console.error('Validation error:', error);
      }
      sessionStorage.removeItem('_cfg_auth');
      passwordInput.style.display = 'block';
      return false;
    }

    async function _0x9d0e() {
      const _0x1f2g = passwordInput.value.trim();
      if (!_0x1f2g) { 
        _0x3h4i('⚠️ رمز را وارد کنید', 'error'); 
        return false; 
      }
      
      try {
        const _0x5j6k = await _0x7r8s();
        const _0x7l8m = await _0x3n4o(_0x1f2g);
        if (_0x7l8m !== _0x5j6k) {
          _0x3h4i('❌ رمز اشتباه است', 'error');
          return false;
        }
        sessionStorage.setItem('_cfg_auth', _0x1f2g);
        passwordInput.style.display = 'none';
        return true;
      } catch (error) {
        console.error('Password validation error:', error);
        _0x3h4i('❌ خطا در تأیید رمز', 'error');
        return false;
      }
    }

    function _0x3h4i(message, type = 'info') {
      status.innerText = message;
      status.className = `status ${type}`;
    }

    async function _0x9n0o(text) {
      try {
        await navigator.clipboard.writeText(text);
        return true;
      } catch (error) {
        console.error('Clipboard API failed:', error);
        try {
          const _0x1p2q = document.createElement('textarea');
          _0x1p2q.value = text;
          _0x1p2q.style.position = 'fixed';
          _0x1p2q.style.opacity = '0';
          document.body.appendChild(_0x1p2q);
          _0x1p2q.select();
          _0x1p2q.setSelectionRange(0, 99999);
          const _0x3r4s = document.execCommand('copy');
          document.body.removeChild(_0x1p2q);
          return _0x3r4s;
        } catch (fallbackError) {
          console.error('Fallback copy failed:', fallbackError);
          return false;
        }
      }
    }

    function _0x5t6u() {
      const _0x7v8w = navigator.userAgent.toLowerCase();
      const _0x9x0y = navigator.platform.toLowerCase();
      
      if (_0x7v8w.includes('android')) return 'android';
      if (_0x7v8w.includes('iphone') || _0x7v8w.includes('ipad')) return 'ios';
      if (_0x9x0y.includes('win')) return 'windows';
      if (_0x9x0y.includes('mac')) return 'macos';
      if (_0x9x0y.includes('linux')) return 'linux';
      
      return 'unknown';
    }

    function _0x1z2a(url) {
      const _0x3b4c = _0x5t6u();
      const _0x5d6e = `hiddify://install-sub?url=${encodeURIComponent(url)}`;
      
      if (_0x3b4c === 'android' || _0x3b4c === 'ios') {
        window.location.href = _0x5d6e;
      } else {
        const _0x7f8g = [
          () => { window.location.href = _0x5d6e; },
          () => {
            const _0x9h0i = document.createElement('a');
            _0x9h0i.href = _0x5d6e;
            _0x9h0i.target = '_blank';
            _0x9h0i.rel = 'noopener';
            document.body.appendChild(_0x9h0i);
            _0x9h0i.click();
            document.body.removeChild(_0x9h0i);
          },
          () => {
            try {
              window.open(_0x5d6e, '_blank');
            } catch (error) {
              console.error('Window.open failed:', error);
            }
          }
        ];
        
        _0x7f8g.forEach((method, index) => {
          setTimeout(method, index * 200);
        });
      }
    }

    // Enhanced secure config fetch
    async function _0x1j2k() {
      const _0x3l4m = {
        method: 'GET',
        headers: {
          'Cache-Control': 'no-cache, no-store, must-revalidate',
          'Pragma': 'no-cache',
          'Expires': '0',
          'X-Requested-With': 'XMLHttpRequest',
          'User-Agent': navigator.userAgent + '_secure_client_' + Date.now(),
          'Accept': 'text/plain,*/*;q=0.9',
          'X-Timestamp': Date.now().toString(),
          'X-Session': btoa(Math.random().toString(36).substring(2, 15))
        }
      };

      const _0x5n6o = await fetch(_0x3c4d, _0x3l4m);
      if (!_0x5n6o.ok) {
        throw new Error(`HTTP ${_0x5n6o.status}: ${_0x5n6o.statusText}`);
      }
      
      const _0x7p8q = await _0x5n6o.text();
      if (!_0x7p8q.trim()) {
        throw new Error('Empty config received');
      }

      return _0x7p8q.trim();
    }

    // Event listeners with security
    fetchBtn.addEventListener('click', async () => {
      // Check for debugging
      const _0x9r0s = new Date();
      debugger;
      if (new Date() - _0x9r0s > 50) {
        document.body.innerHTML = '<h1>⚠️ دسترسی غیرمجاز تشخیص داده شد</h1>';
        return;
      }

      configDisplay.style.display = 'none';
      instructions.style.display = 'none';
      importButtons.style.display = 'none';
      fetchBtn.disabled = true;
      _0x3h4i('');

      if (!await _0x1v2w() && !await _0x9d0e()) {
        fetchBtn.disabled = false;
        return;
      }

      try {
        _0x3h4i('در حال دریافت کانفیگ...', 'info');
        
        _0x9j0k = await _0x1j2k();
        _0x1l2m = _0x3c4d;
        
        configDisplay.innerText = _0x9j0k;
        configDisplay.style.display = 'block';
        configDisplay.className = 'config-display select-text';

        const _0x1t2u = await _0x9n0o(_0x1l2m);
        if (_0x1t2u) {
          _0x3h4i('✅ لینک کانفیگ کپی شد!', 'success');
        } else {
          _0x3h4i('✅ کانفیگ دریافت شد', 'success');
        }

        importButtons.style.display = 'flex';

      } catch (error) {
        console.error('Fetch error:', error);
        _0x3h4i(`❌ خطا: ${error.message}`, 'error');
        instructions.style.display = 'block';
      } finally {
        fetchBtn.disabled = false;
      }
    });

    directImportBtn.addEventListener('click', () => {
      directImportBtn.disabled = true;
      _0x3h4i('در حال تلاش برای باز کردن Hiddify...', 'info');
      
      try {
        _0x1z2a(_0x1l2m);
        
        setTimeout(() => {
          _0x3h4i('✅ اگر Hiddify باز شد، کانفیگ باید اضافه شده باشد', 'success');
          directImportBtn.disabled = false;
        }, 2000);
        
        setTimeout(() => {
          if (status.className.includes('success')) {
            _0x3h4i('⚠️ اگر کانفیگ اضافه نشد، از روش دستی استفاده کنید', 'info');
            instructions.style.display = 'block';
          }
        }, 4000);
        
      } catch (error) {
        console.error('Direct import error:', error);
        _0x3h4i('❌ خطا در باز کردن Hiddify', 'error');
        instructions.style.display = 'block';
        directImportBtn.disabled = false;
      }
    });

    manualImportBtn.addEventListener('click', async () => {
      const _0x3v4w = await _0x9n0o(_0x1l2m);
      if (_0x3v4w) {
        _0x3h4i('✅ لینک کپی شد! آن را در Hiddify وارد کنید', 'success');
        manualImportBtn.innerText = '✅ کپی شد';
        setTimeout(() => {
          manualImportBtn.innerText = '📋 کپی لینک';
        }, 2000);
      } else {
        _0x3h4i('❌ خطا در کپی کردن', 'error');
      }
      instructions.style.display = 'block';
    });

    document.getElementById('manualCopyBtn').addEventListener('click', async () => {
      const _0x5x6y = await _0x9n0o(_0x1l2m);
      const _0x7z8a = document.getElementById('manualCopyBtn');
      _0x7z8a.innerText = _0x5x6y ? '✅ کپی شد!' : '❌ کپی نشد';
      setTimeout(() => {
        _0x7z8a.innerText = '🔄 تلاش مجدد کپی';
      }, 2000);
    });

    // Initialize with security check
    setTimeout(() => {
      _0x1v2w();
    }, 100);

    // Additional security: Clear sensitive data on page unload
    window.addEventListener('beforeunload', () => {
      sessionStorage.removeItem('_cfg_auth');
      _0x9j0k = '';
      _0x1l2m = '';
    });

    // Console warning
    console.warn('⚠️ هشدار امنیتی: این صفحه حفاظت شده است. تلاش برای دسترسی غیرمجاز ممکن است منجر به مسدود شدن شود.');
  </script>
</body>
</html>
